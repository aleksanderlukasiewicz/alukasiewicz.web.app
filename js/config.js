Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(let e=this.length-1;e>=0;e--)this[e].parentElement.removeChild(this[e])};let Item=function(e,t=[],o=!1,n="/"+e,r,i,a,l,s,c=[],d={}){return{id:e,L:t,title:r,P:{B:i,content:a},S:{create:l,modify:s},G:c,N:o,W:n,j:d,type:GLOBAL.item}},ItemDate=function(e,t,o){return{m:e,h:t,C:o}},Group=function(e,t=[],o,n,r,i=[],a={},l=!1){return{id:e,L:t,j:a,title:o,G:i,F:l,S:{create:n,modify:r},type:GLOBAL.group}},Stream=function(e){return{event:e}},View=function(e,t,o={},n={},r=null,i=!1,a=ViewController.M.H){return{id:e,url:t,data:o,event:n,U:r,_:i,q:a}},HistoryItem=function(e,t,o){return{id:e,index:t,j:o}},ErrorClass=function(e,t,o,n=[],r=!0){return{id:e,title:t,message:o,et:n,tt:r}},ViewController=function(){let e={};EventController.call(e,{navigateToView:[],navigateFromView:[],navigateDefault:[],historyEdit:[]});let t,o=[],n=[];e.nt=function(e){-1==o.findIndex((t=>e.id==t.id))&&o.push(e)},e.rt=function(e,i=!1){let a=o.find((t=>e==t.id||e.id==t.id));n.includes(a.id)||(a.et.forEach((e=>n.push(e))),i?(l.forEach((e=>e.re?e.event?.lt.call(e,a):"")),t=a):r.event?.lt.call(r,a))};let r,i,a,l=[],s=-1,c=-1,d=function(e){"string"==typeof e.U&&(e.U=getById(e.U))};return e.navigate=async function(o,n={}){let u=(e=>l.find((t=>t.id==e))||i)(o);var w;r&&(d(r),r.event.$?.call(r,n),e.I("navigateFromView",[r,n]),(w=r).q==e.M.ee&&(w.X=!1),a=r),n.te||(s++,u==i&&(c=s),e.I("historyEdit",[Object.assign(new HistoryItem(u.id,s,{oe:n.oe,ne:n.ne}),{ie:c}),u])),r=u,d(r),await function(e){e._&&!e.re&&(t&&e.event?.lt.call(e,t),e.event.ae?.call(e),e.re=!0)}(r),e.I("navigateToView",[r,a,n]),await(r.event.se?.call(r,n)),r.q!=e.M.le&&(await async function(e,t){e.J||e.X||(e.J=!0,await(e.event.Y?.call(e,t)))}(r,n),await async function(e){e.J&&!e.X&&(e.J=!1,e.X=!0,await(e.event.K?.call(e)))}(r))},e.register=async function(e,t=!1){l.push(e),e._||e.event.ae?.call(e),t&&(i=e)},e.ce=function(t){r!=i&&(e.navigate(i.id,t),e.I("navigateDefault",[t]))},e.back=function(){0==history.state.index?e.ce():history.back()},e.ue={forward:1,back:0},e.M={H:"single",ee:"always",le:"never"},e.move=function(t,o){t==e.ue.forward?s++:s--,e.navigate(o.id,Object.assign({te:!0},o.j))},Object.defineProperties(e,{me:{get:()=>s}}),e}(),ItemController=function(){let e=[],t=[],o=[],n=!1,r=!1,i={};EventController.call(i,{fetchGroup:[],fetchGroupFinish:[],fetchItem:[],fetchItemFinish:[]});let a=e=>encodeURIComponent(e.toLowerCase().replaceAll(" ","-"));ViewController.nt(new ErrorClass("item_not_found","Item don't exist","We don't have what you're looking for")),ViewController.nt(new ErrorClass("group_not_found","Group don't exist","We don't have what you're looking for"));let l,s=async function(e){if(e){if(!e.N&&!e.fe){let t=await async function(e){return new Promise(((t,o)=>{let n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");n.onreadystatechange=function(){4==this.readyState&&(200==this.status?t(JSON.parse(this.responseText)):o("Error in AJAX request"))},n.open("GET",APP.l+e.W+APP.t+APP.i,!0),n.send()}))}(e,e.W);Object.assign(e,t,{ge:[]}),e.ge.push(APP.i),e.content.forEach((t=>t.Ie?e.ge.push(...t.Ie):"")),t?.version==APP.version&&(e.fe=!0)}return e}ViewController.rt("item_not_found")},c=e=>t.find((t=>t.source==e))?.target,d=t=>e.find((e=>e.source==t))?.target;return i.Ae=async function(e){await Promise.all(e.map((async e=>{!function(e){e.content=[],e.id=e.id||a(e.title),t.push(new RouteClass(e.id,e))}(e),o.push(e),e.L.forEach((o=>t.push(new RouteClass(o,e)))),e.F&&(l=e),await i.I("fetchGroup",[e])}))),o.forEach((e=>e.G?.forEach((t=>c(t)?.content.push(e))))),await i.I("fetchGroupFinish"),n=!0},i.he=async function(t){await Promise.all(t.map((async t=>{t.id=t.id||a(t.title),e.push(new RouteClass(t.id,t)),l.content.push(t),t.L.forEach((o=>e.push(new RouteClass(o,t)))),t.G?.forEach((e=>c(e)?.content.push(t))),await i.I("fetchItem",[t])}))),await i.I("fetchItemFinish",[]),r=!0},i.Le={group:"group",item:"item",Pe:"allitems",all:"all"},i.load=async function(e=new Stream,t=i.Le.all,n={},r=e){let a=async o=>Promise.all(o.filter(n.ye||(()=>!0)).sort(n.Ve).map((async(o,n)=>await(e.event.load?.call(r,o,n,t)))));switch(t){case i.Le.item:await(e.event.load?.call(r,await i.pe(n),0,t));break;case i.Le.group:await(e.event.load?.call(r,c(n),0,t));break;case i.Le.Pe:await a(l.content);break;default:await a(o)}await(e.event.Ce?.call(r))},Object.defineProperties(i,{storage:{get:()=>o},ve:{get:()=>r},Be:{get:()=>n},Oe:{value:d},Ge:{value:c},pe:{value:async e=>await s(d(e))}}),i}(),ResourceDownloadController=function(){let e={},t=[],o=[],n=[];return EventController.call(e,{downloadStart:[],download:[],downloadFinish:[],save:[],savePending:[],removeStart:[],remove:[],removeFinish:[]}),e.be=e=>t.includes(e),e.load=e=>t=e,e.qe=async e=>{o=e,await Promise.all(o.map((async e=>{let t=await ItemController.pe(e);t.Ye=!0,n.push(t)})))},e.ze=async function(){await Promise.all(o.map((async(o,r)=>{t.includes(o)||await e.download(n[r])}))),o=[],n=[],e.I("savePending",[{},o])},e.Ke=t=>{o.includes(t.id)||(o.push(t.id),t.Ye=!0,n.push(t),e.I("savePending",[t,o]))},e.Qe=async t=>navigator.onLine?await e.download(t):await e.Ke(t),e.Ze=t=>{if(o.includes(t.id)){let r=o.findIndex((e=>e==t.id));o.splice(r,1),t.Ye=!1,n.splice(r,1),e.I("savePending",[t,o])}},e.download=async function(o){o.$e=!0,t.push(o.id),e.I("downloadStart",[o]),await Promise.all(o.ge.map((async(t,n)=>await e.I("download",[o,t,n])))),o.$e=!1,o.be=!0,o.Ye=!1,e.I("downloadFinish",[o]),e.I("save",[o,t])},e.remove=async function(o){o.be=!1,t.splice(t.findIndex((e=>e==o.id)),1),e.I("removeStart",[o]),await Promise.all(o.ge.map((async t=>await e.I("remove",[o,t])))),e.I("removeFinish",[o]),e.I("save",[o,t])},e}();const landingView=new View(VIEW.o,APP.url.o,{scrollY:-1,Re:!1},{se:function(){this.data.scrollY>=0&&window.scroll(0,this.data.scrollY),document.title=APP.name},ae:function(){let e=this.data,t=getById("profile-link-button");t.href=APP.url.profile,t.addEventListener("click",(()=>{event.preventDefault(),ViewController.navigate(VIEW.profile)})),e.Se=getById("main-list"),this.data.Ee=new Stream({load:async t=>StorageResponseBuilder(t,e.Se,1,-1)})},$:function(){this.data.scrollY=window.scrollY,this.U.classList.remove("error")},K:function(){this.U.classList.remove(GLOBAL.loading),this.data.Se.getElementsByClassName(GLOBAL.A+" loading").remove()},Y:async function(){this.U.classList.add(GLOBAL.loading),ItemController.ve&&ItemController.Be&&await ItemController.load(this.data.Ee,ItemController.Le.group,"landing",this)},lt:function(e){this.U.classList.add("error"),createErrorMsg(e,getById("landing-error-node"))}},VIEW.o,!0,ViewController.M.H),profileView=new View(VIEW.profile,APP.url.profile,{},{se:()=>document.title="About me - "+APP.name},VIEW.profile,!1,ViewController.M.le),itemView=new View(VIEW.item,APP.url.item,{Te:null},{se:()=>window.scroll(0,0),$:function(){this.U.classList.remove("error")},ae:function(){let e=this.data,t=function(t){t.id==e.Te.id&&(i.classList.remove(GLOBAL.V),i.classList.remove(GLOBAL.pending),i.classList.remove(GLOBAL._e),e.Te.be?i.classList.add(GLOBAL.V):e.Te.$e?i.classList.add(GLOBAL._e):e.Te.Ye&&i.classList.add(GLOBAL.pending))},o=getById("item-title"),n=getById("item-content"),r=getById("item-info"),i=getById("item-download-button");i.addEventListener("click",(()=>{e.Te.be?ResourceDownloadController.remove(e.Te):e.Te.Ye?ResourceDownloadController.Ze(e.Te):ResourceDownloadController.Qe(e.Te)})),ResourceDownloadController.addEventListener("downloadStart",t),ResourceDownloadController.addEventListener("downloadFinish",t),e.Ee=new Stream({load:function(i){if(i.N)return window.open(i.N,"_blank").focus(),void ViewController.ce();e.Te=i,t(i),document.title=i.title+" - "+APP.name,incrementVisitors(APP.l+"/"+i.id,!0),o.innerHTML=i.title,r.innerHTML=APP.S(i.S.create)+(i.S.modify?" <u class='dotted-separator'></u> Updated "+APP.S(i.S.modify):""),n.innerHTML="",i.content.forEach((e=>n.append(new ItemComponentBuilder(e,i.W,i))))}}),ResourceDownloadController.addEventListener("remove",t),ResourceDownloadController.addEventListener("savePending",t)},Y:async function(e){this.U.classList.add(GLOBAL.loading),ItemController.ve&&await ItemController.load(this.data.Ee,ItemController.Le.item,e.oe[0],this)},K:function(){this.U.classList.remove(GLOBAL.loading)},lt:function(e){this.U.classList.add("error"),createErrorMsg(e,getById("item-error-node"))}},VIEW.item,!0,ViewController.M.ee),groupView=new View(VIEW.group,APP.url.group,{scrollY:-1},{ae:function(){let e=getById("group-title"),t=getById("group-info"),o=this.data;o.ke=getById("group-data"),o.Ne=getById("group-list"),this.data.Ee=new Stream({load:async function(n){n?(o.Fe=n,e.innerHTML=n.title,document.title=n.title+" - "+APP.name,t.innerHTML=APP.S(n.S.create)+" <u class='dotted-separator'></u> "+n.content.length+"&nbsp;"+(1!=n.content.length?"items":"item"),this.data.ke.classList.remove(GLOBAL.loading),await StorageResponseBuilder(n,o.Ne,1,-1)):ViewController.rt("item_not_found")}})},se:()=>window.scroll(0,0),$:function(){Array.prototype.forEach.call(this.data.Ne.getElementsByClassName(GLOBAL.A),(e=>e.classList.add("loading"))),this.U.classList.remove("error")},Y:async function(e){this.U.classList.add(GLOBAL.loading),this.data.ke.classList.add(GLOBAL.loading),await ItemController.load(this.data.Ee,ItemController.Le.group,e.oe[0],this)},K:function(){this.U.classList.remove(GLOBAL.loading),this.data.Ne.getElementsByClassName("loading").remove()},lt:function(e){this.U.classList.add("error"),createErrorMsg(e,getById("group-error-node"))}},VIEW.group,!0,ViewController.M.ee);ViewController.register(landingView,!0),ViewController.register(profileView),ViewController.register(itemView),ViewController.register(groupView),ResourceDownloadController.addEventListener("download",(async(e,t)=>await cacheResource(APP.l+e.W+APP.t+t))),ResourceDownloadController.addEventListener("remove",(async(e,t)=>await removeResourceFromCache(APP.l+e.W+APP.t+t))),ViewController.addEventListener("historyEdit",((e,t)=>0==e.index?history.replaceState(e,"",t.url+(e.j.oe?.join("/")||"")):history.pushState(e,"",t.url+(e.j.oe?.join("/")||"")))),ViewController.addEventListener("navigateDefault",(()=>-1!=history.state.ie&&history.state.ie-history.state.index!=0?history.go(history.state.ie-history.state.index):"")),ViewController.addEventListener("navigateToView",((e,t)=>{e.U.classList.add(GLOBAL.u),APPNODE.classList.replace(t?.id,e.id)})),ViewController.addEventListener("navigateFromView",(e=>e.U.classList.remove(GLOBAL.u))),ItemController.addEventListener("fetchItem",(e=>e.be=ResourceDownloadController.be(e.id))),ResourceDownloadController.addEventListener("save",((e,t)=>window.localStorage[STORAGE.T]=JSON.stringify(t))),ResourceDownloadController.addEventListener("savePending",((e,t)=>window.localStorage[STORAGE.Je]=JSON.stringify(t))),window.addEventListener("load",(async function(){if(ResourceDownloadController.load(LocalStorageArrayParser(STORAGE.T)),ViewController.nt(new ErrorClass("item_load_error","Items cannot be loaded","Try refreshing the page",["item_outdated","item_not_found","item_error","group_not_found"])),ViewController.nt(new ErrorClass("item_outdated","Items are outdated","Try refreshing the page",["item_load_error","item_not_found","item_error","group_not_found"])),APP.version!=ITEM_VERSION)ViewController.rt("item_outdated",!0);else try{await ItemController.Ae(getGroups()).then((()=>ItemController.he(getItems())))}catch{ViewController.rt("item_load_error",!0)}await ViewController.navigate(START_ROUTE.target,{oe:START_URL.slice(1,START_URL.length-1)}),APPNODE.classList.toggle(GLOBAL.g,!navigator.onLine),await ResourceDownloadController.qe(LocalStorageArrayParser(STORAGE.Je)),this.navigator.onLine&&ResourceDownloadController.ze(),setTimeout((()=>document.body.classList.remove("first-start")),300)})),window.addEventListener("online",(()=>{APPNODE.classList.remove(GLOBAL.g),ResourceDownloadController.qe(LocalStorageArrayParser(STORAGE.Je)),ResourceDownloadController.ze()})),window.addEventListener("offline",(()=>APPNODE.classList.add(GLOBAL.g))),window.addEventListener("popstate",(e=>ViewController.move(ViewController.me-e.state.index<=0,e.state)));let createItemTile=async function(e,t){if("A"!=e.nodeName){let t=e;e=document.createElement("A"),t.parentElement.replaceChild(e,t)}e.className="item "+GLOBAL.A+" "+GLOBAL.loading,e.innerHTML="<div class='img'><img src='"+APP.l+t.W+t.P.B+"' alt='"+t.title+"'/></div><b class='font-subtitle'>"+t.title+"</b><span class='font-base'>"+t.P.content+"</span><div class='labels'><div class='button'>"+(t.N?"Open link <i class='mi mi-OpenInNewWindow'></i>":"Read more <i class='mi mi-BackMirrored'></i>")+"</div>"+(t.S.modify?"<div class='label font-caption'><i class='mi mi-Update'></i> &nbsp;&nbsp;"+APP.S(t.S.modify)+"</div>":"")+"</div>";let o=e.children[0].children[0];return await new Promise((e=>{o.onload=()=>e((t.j.We&&(o.style=t.j.We),void cacheResource(APP.l+t.W+t.P.B))),o.onerror=()=>e((t.xe=!0,o.src="/img/image_error.webp",void(o.onload=function(){})))})),e.classList.replace(GLOBAL.loading,GLOBAL.loaded),e.onclick=function(){event.preventDefault(),t.N?window.open(t.N,"_blank").focus():ViewController.navigate(VIEW.item,{oe:[t.id]})},e.href=t.N||APP.url.item+t.id,setTimeout((()=>e.classList.remove(GLOBAL.loaded)),300),e},createGroupTile=function(e,t){return e.className="group "+GLOBAL.A,e.innerHTML="<span class='font-title'></span><a class='button'><i class='mi mi-ShowAll'></i> <span>Show all</span></a>",e.children[0].innerHTML=t.title,e.children[1].onclick=function(){event.preventDefault(),ViewController.navigate(VIEW.group,{oe:[t.id]})},e.children[1].href=APP.url.group+t.id,e},StorageResponseIndexer=function(e,t=1,o=3,n=0,r=3){let i=[];return e.content?.forEach(((a,l)=>{a.type==GLOBAL.group?t>0&&(i.push({index:n,Me:a}),i=i.concat(StorageResponseIndexer(a,t-1,r,n+1)),n=i[i.length-1].index+1):(o>0&&(!a.Ue||e.content.length-l<=o)||-1==o)&&(a.Ue=!0,i.push({index:n,Me:a}),o>0&&(o-=1),n+=1)})),i},StorageResponseBuilder=async function(e,t=document.createElement("DIV"),o=1,n=3){let r=[...t.getElementsByClassName(GLOBAL.A)],i=StorageResponseIndexer(e,o,n,0);await Promise.all(i.map((async e=>{e.Me.Ue=!1,e.Me.type==GLOBAL.group?createGroupTile(r[e.index]||t.appendChild(document.createElement("div")),e.Me):await createItemTile(r[e.index]||t.appendChild(document.createElement("a")),e.Me)})))},LocalStorageArrayParser=(e,t=[])=>window.localStorage[e]?JSON.parse(window.localStorage[e]):t,createErrorMsg=function(e,t){if(t.innerHTML="<i class='mi mi-Error font-header'></i><div class='font-title'>"+e.title+"</div><span class='font-base'>"+e.message+"</span>",e.tt){let e=document.createElement("A");e.classList.add("button"),e.innerHTML="<i class='mi mi-Refresh'></i><span>Refresh page</span>",e.addEventListener("click",(()=>window.location.reload(!0))),t.appendChild(e)}},ItemComponentBuilder=function(e,t){let o,n=e.type,r=e.arguments||{};switch(n){case"section":if(o=document.createElement("DIV"),o.classList.add("section"),!r.je){let t=document.createElement("DIV");t.className="section-title font-subtitle",t.innerText=e.title,o.append(t)}o.append(e.content);break;case"image":o=document.createElement("DIV"),o.classList.add("image");let n=document.createElement("IMG");n.src=APP.l+t+APP.t+e.Ie[0];let i=document.createElement("SPAN");i.className="img-alt",i.innerHTML=e.alt||"",o.appendChild(n),o.appendChild(i),n.onerror=function(){n.onload=function(){},n.src="/img/image_error.webp",n.classList.add("no-image")};break;case"quote":o=document.createElement("DIV");let a=document.createElement("DIV"),l=document.createElement("SPAN");o.className="quote",a.className="font-header",l.className="font-base",a.innerHTML=e.content,l.innerHTML=e.He,o.appendChild(a),o.appendChild(l);break;case"text":o=document.createElement("DIV"),o.innerHTML=e.content;break;case"multi-section":if(o=document.createElement("DIV"),o.classList.add("section"),!r.je){let e=document.createElement("DIV");e.className="section-title font-subtitle",e.innerText=title,o.append(e)}o.forEach((e=>o.append(new ItemComponentBuilder(e,t))));break;case"gallery":o=document.createElement("DIV"),o.classList.add("gallery"),o.innerHTML="<div><b class='font-subtitle'>"+e.title+"</b></div><div class='list'></div>";let s=document.createElement("A");s.innerHTML="<i class='mi mi-Picture'></i><span>Show all</span>",s.classList.add("button"),o.children[0].appendChild(s);let c=e.Ie.length>5?5:e.Ie.length;for(let n=0;n<c;n++){let r=e.Ie[n],i=document.createElement("IMG");i.src=APP.l+t+APP.t+r,o.children[1].appendChild(i)}break;default:o=document.createElement("DIV")}return o};