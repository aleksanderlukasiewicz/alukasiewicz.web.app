const COMPONENTS_VERSION=1;let ItemBuilder=function(e){let t=e.folder;e.content.map((async function(r,s){if(r.resources){let n=0;for(;n<r.resources.length;){let e=ResourceConverter(r.resources[n],APP.itemFolder+t+APP.resourceFolder,r.id||s);r.resources.splice(n,1,...e),n+=e.length}r.resourceGroupIndex=e.resources.length,e.resources.push(new ResourceGroup(r.resources))}})),e.debug&&console.log(e)},ResourceConverter=function(e,t,r){let s=[],n=t=>s.push(new Resource(APP.itemFolder+t.folder+t.tile.image,"image",createHash(APP.itemFolder+t.folder+t.tile.image+r),e.props));switch(e.type){case"group":let a=AppStorage.getGroupById(e.id);if(!a)return s;a.content.forEach((e=>{e.arg?.ignoreTileImageInGallery||n(e)}));break;case"image":s.push(new Resource(t+e.src,"image",createHash(t+e.src+r),e.props));break;case"item":let o=AppStorage.getItemSnapshotById(e.id);n(o);break;default:s.push(e)}return s},ItemComponentBuilder=async function(e,t,r){if("string"==typeof e)return e;let s,n=e.type,a=e.arguments||{};switch(e.dontRender&&(n="none"),n){default:if(s=document.createElement("DIV"),s.className="section",e.title){let t=document.createElement("DIV");t.className="section-title font-subtitle",t.innerText=e.title,s.append(t)}"string"==typeof e.content?s.append(e.content):e.content.forEach((async e=>s.append(await ItemComponentBuilder(e,t,r))));break;case"quote":s=document.createElement("DIV"),s.className="quote";let n=document.createElement("DIV");n.className="font-header",n.innerHTML=e.content;let o=document.createElement("SPAN");o.className="font-base",o.innerHTML=e.author,s.appendChild(n),s.appendChild(o);break;case"gallery":s=document.createElement("DIV"),s.className="gallery";let l=[],c=5,i=a.imagesCount&&a.imagesCount<=c?a.imagesCount:e.resources.length<c?e.resources.length:c,u=new Array(i);if(a.resourceOrder){let t=0;for(let r=0;r<e.resources.length;r++){let s=e.resources[r],n=a.resourceOrder.findIndex((e=>e==s.hash));if(-1!=n&&(u[n]=s,s.isDisplayed=!0,t++),t==a.resourceOrder.length)break}if(u=u.filter((e=>e)),t<i){let r=i-t,s=0;for(;r>0;)e.resources[s].isDisplayed||(u[i-r]=e.resources[s],r--),s++}}else for(let t=0;t<i;t++)u[t]=e.resources[t];if(!a.hideControls&&e.resources.length>1){s.innerHTML="<div><b class='font-subtitle'>"+e.title+"</b></div>",s.classList.add("show-controls");let t=document.createElement("A");t.innerHTML="<i class='mi mi-Picture'></i><span>Show all</span>",t.className="button",t.onclick=function(){AppViews.navigate(VIEW.resource,{routeArg:[r.id,u[0].hash],currentItem:r})},s.children[0].appendChild(t)}let d=document.createElement("DIV");d.className="list",s.appendChild(d);for(let e=0;e<i;e++){let t=u[e],s=document.createElement("IMG");s.alt=t?.props?.alt||"",s.src=t.src,s.className=GLOBAL.loading,d.appendChild(s),l.push(ImageHelper(s,(function(e){e.onclick=function(){AppViews.navigate(VIEW.resource,{routeArg:[r.id,t.hash],currentItem:r})},e.classList.remove(GLOBAL.loading)}),(e=>e.classList.remove(GLOBAL.loading))))}if(Promise.all(l.map((async e=>await e))),s.classList.add("items-count-"+i),e.arguments?.alt){let t=document.createElement("span"),r="boolean"==typeof e.arguments.alt?e.resources[0].props.alt:e.arguments.alt;t.innerHTML=r,t.classList.add("img-alt"),s.appendChild(t)}break;case"link":s=document.createElement("A"),s.className="link",s.innerHTML=e.content,s.href=e.href,s.target=e.target}return s};